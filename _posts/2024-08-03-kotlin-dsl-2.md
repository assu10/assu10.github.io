---
layout: post
title: "Kotlin - DSL(2): "
date: 2024-08-03
categories: dev
tags: kotlin dsl
---

이 포스트에서는 DSL 에 대해 알아본다.

- `invoke()` 관례 사용

`invoke()` 관례를 사용하면 DSL 코드 안에서 람다와 프로퍼티 대입을 더 유연하게 조립할 수 있다.

> 소스는 [github](https://github.com/assu10/kotlin-2/tree/feature/chap11) 에 있습니다.

---

**목차**

<!-- TOC -->
* [1. `invoke()` 관례를 사용한 블록 중첩](#1-invoke-관례를-사용한-블록-중첩)
  * [1.1. `invoke()` 관례: 함수처럼 호출할 수 있는 객체](#11-invoke-관례-함수처럼-호출할-수-있는-객체)
  * [1.2. `invoke()` 관례와 함수형 타입](#12-invoke-관례와-함수형-타입)
  * [1.3. DSL 의 `invoke()` 관례: Gradle 에서 의존관계 정의](#13-dsl-의-invoke-관례-gradle-에서-의존관계-정의)
* [2. 실전 DSL](#2-실전-dsl)
  * [2.1. 중위 호출 연쇄: 테스트 프레임워크의 `should`](#21-중위-호출-연쇄-테스트-프레임워크의-should)
  * [2.2. primitive 타입에 대한 확장 함수 정의: 날짜 처리](#22-primitive-타입에-대한-확장-함수-정의-날짜-처리)
  * [2.3. 멤버 확장 함수: SQL 을 위한 내부 DSL](#23-멤버-확장-함수-sql-을-위한-내부-dsl)
* [정리하며..](#정리하며)
* [참고 사이트 & 함께 보면 좋은 사이트](#참고-사이트--함께-보면-좋은-사이트)
<!-- TOC -->

---

**개발 환경**

- 언어: kotlin 1.9.23
- IDE: intelliJ
- SDK: JDK 17
- 의존성 관리툴: Gradle 8.5

---

# 1. `invoke()` 관례를 사용한 블록 중첩

`invoke()` 관례를 사용하면 함수처럼 호출할 수 있는 객체를 만드는 클래스를 정의하여 객체를 함수처럼 호출할 수 있다.  
하지만 이 기능은 일상적으로 사용하기 위한 기능은 아님을 유의해야 한다.  
`invoke()` 관례를 남용하면 _1 ()_ 과 같이 이해하기 어려운 코드가 생길 수 있다.

DSL 에서는 `invoke()` 관례가 유용할 때가 있는데 먼저 `invoke()` 관례 자체에 대해 먼저 알아본다.

---

## 1.1. `invoke()` 관례: 함수처럼 호출할 수 있는 객체

[Kotlin - 연산자 오버로딩, 'infix', 가변 컬렉션에 '+=', '+' 적용, Comparable, 구조 분해 연산자](https://assu10.github.io/dev/2024/03/23/kotlin-advanced-3/) 에서 
코틀린 관례에 대해 살펴보았다.

> `invoke()` 에 대한 간단한 설명은 [1.7. 호출 연산자: `invoke()`](https://assu10.github.io/dev/2024/03/23/kotlin-advanced-3/#17-%ED%98%B8%EC%B6%9C-%EC%97%B0%EC%82%B0%EC%9E%90-invoke) 를 참고하세요.

관례는 특별한 이름이 붙은 함수를 일반 메서드 호출 구문으로 호출하지 않고 더 간단한 다른 구문으로 호출할 수 있게 지원하는 기능이다.

예를 들어 _foo_ 라는 변수에 대해 _foo[bar]_ 라는 식을 사용하면 _foo.get(bar)_ 로 변환된다.  
이 때 `get()` 은 _Foo_ 라는 클래스 안에 정의된 함수이거나, _Foo_ 에 대해 정의된 확장 함수이어야 한다.

`operator` 변경자가 붙은 `invoke()` 메서드 정의가 들어있는 클래스의 객체를 함수처럼 호출할 수 있다.

클래스안에서 `invoke()` 메서드를 정의하는 예시

```kotlin
package com.assu.study.kotlin2me.chap11.invoke

class Greeter(val greeting: String) {
    // Greeter 클래스 안에 invoke() 메서드 정의
    operator fun invoke(name: String) {
        println("$greeting, $name~")
    }
}

fun main() {
    val greeter = Greeter("Hi")
    
    // Greeter 인스턴스를 함수처럼 호출
    greeter("Assu") // Hi, Assu!
}
```

_Greeter_ 클래스 안에 `invoke()` 메서드를 정의하였기 때문에 _Greeter_ 인스턴스를 함수처럼 호출할 수 있다.

```kotlin
greeter("Assu") // Hi, Assu!

// 아래처럼 컴파일됨
greeter.invoke("Assu")
```

`invoke()` 관례는 미리 정해둔 이름을 사용한 메서드를 통해서 긴 식 대신 더 짧고 간결한 식을 사용할 수 있도록 해준다.

`invoke()` 메서드의 시그니처에 대한 요구 사항은 없다.  
원하는 대로 파라메터 개수나 타입을 지정할 수 있고, 여러 파라메터 타입을 지원하기 위해 `invoke()` 를 오버로딩할 수도 있다.  
이렇게 오버로딩한 `invoke()` 가 있는 클래스의 인스턴스를 함수처럼 사용할 때는 오버로딩한 여러 시그니처를 모두 다 활용할 수 있다.

이제 이런 관례를 실제로 어떻게 활용할 수 있는지에 대해 알아본다.  
일반적인 프로그램을 작성할 때 `invoke()` 관례를 어떻게 활용하는지 먼저 알아본 후 DSL 에서 활용하는지 알아본다.

---

## 1.2. `invoke()` 관례와 함수형 타입

---

## 1.3. DSL 의 `invoke()` 관례: Gradle 에서 의존관계 정의

---

# 2. 실전 DSL

---

## 2.1. 중위 호출 연쇄: 테스트 프레임워크의 `should`

---

## 2.2. primitive 타입에 대한 확장 함수 정의: 날짜 처리

---

## 2.3. 멤버 확장 함수: SQL 을 위한 내부 DSL

---

# 정리하며..

---

# 참고 사이트 & 함께 보면 좋은 사이트

*본 포스트는 드리트리 제메로프, 스베트라나 이사코바 저자의 **Kotlin In Action** 을 기반으로 스터디하며 정리한 내용들입니다.*

* [Kotlin In Action](https://www.yes24.com/Product/Goods/55148593)
* [Kotlin In Action 예제 코드](https://github.com/AcornPublishing/kotlin-in-action)
* [Kotlin Github](https://github.com/jetbrains/kotlin)
* [코틀린 doc](https://kotlinlang.org/docs/home.html)
* [코틀린 lib doc](https://kotlinlang.org/api/latest/jvm/stdlib/)
* [코틀린 스타일 가이드](https://kotlinlang.org/docs/coding-conventions.html)
* [Exposed github](https://github.com/JetBrains/Exposed)
* [kotlin-dsl-samples github](https://github.com/gradle/kotlin-dsl-samples)
* [kotest github](https://github.com/kotest/kotest)
* [kotlinx.html github](https://github.com/Kotlin/kotlinx.html)